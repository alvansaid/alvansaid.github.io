<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sales Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      padding: 2rem;
    }
    .container {
      max-width: 1400px;
      margin: auto;
      background: #fff;
      border-radius: 20px;
      padding: 2rem;
    }
    h1 { margin-bottom: .25rem; }
    .subtitle { color: #718096; margin-bottom: 1.5rem; }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .kpi-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 1.25rem;
      border-radius: 12px;
    }
    .kpi-label { font-size: .8rem; opacity: .85; }
    .kpi-value { font-size: 1.8rem; font-weight: 700; }

    .chart-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .chart-card {
      background: #f7fafc;
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid #e2e8f0;
    }
    .chart-title { font-weight: 600; margin-bottom: .75rem; }

    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: .75rem;
      border-bottom: 1px solid #e2e8f0;
    }
    thead { background: #667eea; color: #fff; }

    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }
    label { font-size: .8rem; }
    input, select {
      width: 100%;
      padding: .4rem;
    }

    canvas { max-height: 280px; }
  </style>
</head>

<body>
<div class="container">
  <h1>ðŸ“Š Sales Dashboard</h1>
  <p class="subtitle">Live CSV â€¢ Client-ready demo</p>

  <div id="dashboard" style="display:none">

    <!-- FILTERS -->
    <div class="chart-card" style="margin-bottom:1.5rem">
      <div class="chart-title">Filters</div>
      <div class="filters">
        <div>
          <label>Date from</label>
          <input type="date" id="f-date-from">
        </div>
        <div>
          <label>Date to</label>
          <input type="date" id="f-date-to">
        </div>
        <div>
          <label>Category</label>
          <select id="f-category"><option value="">All</option></select>
        </div>
        <div>
          <label>Product</label>
          <select id="f-product"><option value="">All</option></select>
        </div>
      </div>
    </div>

    <!-- KPI -->
    <div class="kpi-grid">
      <div class="kpi-card"><div class="kpi-label">Revenue</div><div class="kpi-value" id="k-rev">-</div></div>
      <div class="kpi-card"><div class="kpi-label">Transactions</div><div class="kpi-value" id="k-tx">-</div></div>
      <div class="kpi-card"><div class="kpi-label">Avg Value</div><div class="kpi-value" id="k-avg">-</div></div>
      <div class="kpi-card"><div class="kpi-label">Top Category</div><div class="kpi-value" id="k-cat">-</div></div>
    </div>

    <!-- CHARTS -->
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-title">Monthly Revenue</div>
        <canvas id="monthlyChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-title">By Category</div>
        <canvas id="categoryChart"></canvas>
      </div>
    </div>

    <!-- TABLE -->
    <div class="chart-card">
      <div class="chart-title">Top Products</div>
      <table>
        <thead>
          <tr><th>#</th><th>Product</th><th>Category</th><th>Units</th><th>Revenue</th></tr>
        </thead>
        <tbody id="tbl"></tbody>
      </table>
    </div>

  </div>
</div>

<script>
const CSV_FILE = 'sample_sales_data.csv';
let rawData = [];
let filtered = [];
let monthlyChart, categoryChart;

const money = v => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(v);
const num = v => new Intl.NumberFormat('id-ID').format(v);

Papa.parse(CSV_FILE,{
  download:true,
  header:true,
  dynamicTyping:true,
  complete:r=>{
    rawData = r.data.filter(d=>d.TotalHarga && d.OrderDate);
    setupFilters();
    applyFilters();
    document.getElementById('dashboard').style.display='block';
  }
});

function setupFilters(){
  const cats=[...new Set(rawData.map(d=>d.Category))];
  const prods=[...new Set(rawData.map(d=>d.ProductName))];
  cats.forEach(v=>f-category.add(new Option(v,v)));
  prods.forEach(v=>f-product.add(new Option(v,v)));
  document.querySelectorAll('input,select').forEach(e=>e.onchange=applyFilters);
}

function applyFilters(){
  const df=f-date-from.value, dt=f-date-to.value, c=f-category.value, p=f-product.value;
  filtered = rawData.filter(d=>{
    const t=new Date(d.OrderDate);
    if(df && t<new Date(df))return false;
    if(dt && t>new Date(dt))return false;
    if(c && d.Category!==c)return false;
    if(p && d.ProductName!==p)return false;
    return true;
  });
  render();
}

function render(){
  if(monthlyChart)monthlyChart.destroy();
  if(categoryChart)categoryChart.destroy();

  const rev=filtered.reduce((s,d)=>s+d.TotalHarga,0);
  document.getElementById('k-rev').textContent=money(rev);
  document.getElementById('k-tx').textContent=num(filtered.length);
  document.getElementById('k-avg').textContent=money(rev/filtered.length||0);

  const byCat={};
  filtered.forEach(d=>byCat[d.Category]=(byCat[d.Category]||0)+d.TotalHarga);
  const topCat=Object.entries(byCat).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('k-cat').textContent=topCat?topCat[0]:'-';

  const byMonth={};
  filtered.forEach(d=>{
    const k=new Date(d.OrderDate).toLocaleDateString('id-ID',{month:'short',year:'numeric'});
    byMonth[k]=(byMonth[k]||0)+d.TotalHarga;
  });

  monthlyChart=new Chart(monthlyChart.getContext('2d'),{
    type:'bar',
    data:{labels:Object.keys(byMonth),datasets:[{data:Object.values(byMonth)}]},
    options:{plugins:{legend:{display:false}}}
  });

  categoryChart=new Chart(categoryChart.getContext('2d'),{
    type:'doughnut',
    data:{labels:Object.keys(byCat),datasets:[{data:Object.values(byCat)}]}
  });

  const prod={};
  filtered.forEach(d=>{
    prod[d.ProductName]=prod[d.ProductName]||{rev:0,qty:0,cat:d.Category};
    prod[d.ProductName].rev+=d.TotalHarga;
    prod[d.ProductName].qty+=d.Jumlah||0;
  });

  tbl.innerHTML=Object.entries(prod)
    .sort((a,b)=>b[1].rev-a[1].rev)
    .slice(0,10)
    .map((p,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${p[0]}</td>
        <td>${p[1].cat}</td>
        <td>${num(p[1].qty)}</td>
        <td>${money(p[1].rev)}</td>
      </tr>`).join('');
}
</script>
</body>
</html>
